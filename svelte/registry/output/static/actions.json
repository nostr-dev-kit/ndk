{"name":"actions","type":"registry:component","title":"Actions","description":"Reusable action components for reactions, zaps, and other event interactions","registryDependencies":[],"dependencies":["@nostr-dev-kit/ndk","@nostr-dev-kit/svelte"],"files":[{"content":"// Action components - minimal wrappers around NDK builders\n// For follow functionality, use createFollowAction directly or FollowButton blocks\n// For mute functionality, use createMuteAction directly\n// For reply functionality, use createReplyAction directly\n\nexport { default as ReactionAction } from './reaction.svelte';\nexport { default as ZapAction } from './zap.svelte';\n","type":"registry:lib","target":"actions/index.ts"},{"content":"<script lang=\"ts\">\n  import type { NDKEvent } from '@nostr-dev-kit/ndk';\n  import type { NDKSvelte, EmojiData } from '@nostr-dev-kit/svelte';\n  import { createReactionAction } from '@nostr-dev-kit/svelte';\n  import { getContext } from 'svelte';\n  import { cn } from '../../utils/cn.js';\n  import { Popover } from 'bits-ui';\n  import { EmojiPicker } from '../../ui';\n\n  interface Props {\n    /** NDKSvelte instance (optional if used in EventCard) */\n    ndk?: NDKSvelte;\n\n    /** Event to react to (optional if used in EventCard) */\n    event?: NDKEvent;\n\n    /** Default emoji to show */\n    emoji?: string;\n\n    /** Whether to show reaction count */\n    showCount?: boolean;\n\n    /** Long press duration in ms */\n    longPressDuration?: number;\n\n    /** Additional CSS classes */\n    class?: string;\n  }\n\n  let {\n    ndk: ndkProp,\n    event: eventProp,\n    emoji = '❤️',\n    showCount = true,\n    longPressDuration = 500,\n    class: className = ''\n  }: Props = $props();\n\n  // Try to get from EventCard context if not provided as props\n  const EVENT_CARD_CONTEXT_KEY = Symbol.for('event-card');\n  const ctx = getContext<any>(EVENT_CARD_CONTEXT_KEY);\n  let ndk = $derived(ndkProp || ctx?.ndk);\n  let event = $derived(eventProp || ctx?.event);\n\n  // Use the builder for reactive state\n  const reaction = $derived.by(() => {\n    if (!ndk) return null;\n    return createReactionAction(() => ({ event }), ndk);\n  });\n\n  // Get stats for the default emoji\n  const stats = $derived(reaction?.get(emoji) ?? { count: 0, hasReacted: false, pubkeys: [], emoji });\n\n  let showPicker = $state(false);\n  let longPressTimer: ReturnType<typeof setTimeout> | null = null;\n  let isLongPress = $state(false);\n\n  function handlePointerDown() {\n    isLongPress = false;\n    longPressTimer = setTimeout(() => {\n      isLongPress = true;\n      showPicker = true;\n    }, longPressDuration);\n  }\n\n  function handlePointerUp() {\n    if (longPressTimer) {\n      clearTimeout(longPressTimer);\n      longPressTimer = null;\n    }\n\n    // Only react if it wasn't a long press\n    if (!isLongPress) {\n      handleQuickReact();\n    }\n  }\n\n  function handlePointerCancel() {\n    if (longPressTimer) {\n      clearTimeout(longPressTimer);\n      longPressTimer = null;\n    }\n    isLongPress = false;\n  }\n\n  async function handleQuickReact() {\n    if (!ndk?.$currentPubkey || !reaction) {\n      return;\n    }\n\n    try {\n      await reaction.react(emoji);\n    } catch (error) {\n      console.error('Failed to react:', error);\n    }\n  }\n\n  async function handleEmojiSelect(emojiData: EmojiData) {\n    if (!ndk?.$currentPubkey || !reaction) {\n      return;\n    }\n\n    try {\n      await reaction.react(emojiData);\n    } catch (error) {\n      console.error('Failed to publish reaction:', error);\n    }\n  }\n</script>\n\n<Popover.Root bind:open={showPicker}>\n  <Popover.Trigger>\n    {#snippet child({ props })}\n      <button\n        {...props}\n        class={cn(\n          'inline-flex items-center gap-2 p-2 bg-transparent border-none cursor-pointer transition-all duration-200 select-none touch-manipulation',\n          stats.hasReacted && 'text-red-500',\n          className\n        )}\n        onpointerdown={handlePointerDown}\n        onpointerup={handlePointerUp}\n        onpointercancel={handlePointerCancel}\n        onpointerleave={handlePointerCancel}\n        aria-label={`React with ${emoji}`}\n        title=\"Click to react, long-press for more emojis\"\n      >\n        <svg\n          class={cn(\n            'flex-shrink-0',\n            stats.hasReacted && 'animate-[heartbeat_0.3s_ease-in-out]'\n          )}\n          xmlns=\"http://www.w3.org/2000/svg\"\n          viewBox=\"0 0 24 24\"\n          width=\"18\"\n          height=\"18\"\n          color=\"currentColor\"\n          fill={stats.hasReacted ? 'currentColor' : 'none'}\n        >\n          <path d=\"M10.4107 19.9677C7.58942 17.858 2 13.0348 2 8.69444C2 5.82563 4.10526 3.5 7 3.5C8.5 3.5 10 4 12 6C14 4 15.5 3.5 17 3.5C19.8947 3.5 22 5.82563 22 8.69444C22 13.0348 16.4106 17.858 13.5893 19.9677C12.6399 20.6776 11.3601 20.6776 10.4107 19.9677Z\" stroke=\"currentColor\" stroke-width=\"1.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\" />\n        </svg>\n\n        {#if showCount && stats.count > 0}\n          <span class=\"text-sm font-medium min-w-4 text-center\">{stats.count}</span>\n        {/if}\n      </button>\n    {/snippet}\n  </Popover.Trigger>\n\n  {#if ndk}\n    <Popover.Content\n      class=\"z-50 w-80 rounded-lg border bg-card p-4 shadow-md outline-none\"\n      sideOffset={8}\n    >\n      <EmojiPicker.Content\n        {ndk}\n        onSelect={(emojiData) => {\n          handleEmojiSelect(emojiData);\n          showPicker = false;\n        }}\n      />\n    </Popover.Content>\n  {/if}\n</Popover.Root>\n\n<style>\n  @keyframes heartbeat {\n    0%, 100% {\n      transform: scale(1);\n    }\n    50% {\n      transform: scale(1.2);\n    }\n  }\n</style>\n","type":"registry:file","target":"actions/reaction.svelte"},{"content":"<!--\n  @component ZapAction\n  Zap (lightning payment) button with amount display.\n-->\n<script lang=\"ts\">\n  import { NDKEvent, type NDKUser } from '@nostr-dev-kit/ndk';\n  import type { NDKSvelte } from '@nostr-dev-kit/svelte';\n  import { createZapAction } from '@nostr-dev-kit/svelte';\n  import { getContext } from 'svelte';\n  import { cn } from '../../utils/cn.js';\n\n  interface Props {\n    ndk?: NDKSvelte;\n    event?: NDKEvent;\n    user?: NDKUser;\n    amount?: number;\n    showCount?: boolean;\n    class?: string;\n  }\n\n  let { ndk: ndkProp, event: eventProp, user, amount = 1000, showCount = true, class: className = '' }: Props = $props();\n\n  const EVENT_CARD_CONTEXT_KEY = Symbol.for('event-card');\n  const ctx = getContext<any>(EVENT_CARD_CONTEXT_KEY);\n  let ndk = $derived(ndkProp || ctx?.ndk);\n  let event = $derived(eventProp || ctx?.event);\n  let target = $derived(event || user);\n\n  const zapState = $derived.by(() => {\n    if (!ndk) return null;\n    return createZapAction(() => ({ target }), ndk);\n  });\n\n  async function handleZap() {\n    if (!ndk?.$currentPubkey || !zapState) {\n      return;\n    }\n    try {\n      await zapState.zap(amount);\n    } catch (error) {\n      console.error('Failed to zap:', error);\n    }\n  }\n</script>\n\n<button\n  onclick={handleZap}\n  class={cn(\n    'inline-flex items-center gap-2 p-2 bg-transparent border-none cursor-pointer transition-colors',\n    zapState?.hasZapped && 'text-amber-500',\n    className\n  )}\n  aria-label={`Zap (${zapState?.totalAmount ?? 0} sats)`}\n>\n  <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" width=\"18\" height=\"18\" color=\"currentColor\" fill={zapState?.hasZapped ? 'currentColor' : 'none'}>\n    <path d=\"M13 2L3 14H12L11 22L21 10H12L13 2Z\" stroke=\"currentColor\" stroke-width=\"1.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n  </svg>\n  {#if showCount && zapState && zapState.totalAmount > 0}\n    <span class=\"text-sm font-medium\">{zapState.totalAmount}</span>\n  {/if}\n</button>\n","type":"registry:file","target":"actions/zap.svelte"}],"version":"0.10.0","updatedAt":"2025-10-31T07:15:56.000Z"}