{"name":"event-content","type":"registry:component","title":"Event Content","description":"Rich event content renderer with automatic parsing of mentions, hashtags, media, and more","registryDependencies":["mention-preview","embedded-event","hashtag-preview"],"dependencies":["@nostr-dev-kit/ndk","@nostr-dev-kit/svelte"],"files":[{"content":"<!-- @ndk-version: event-content@0.7.0 -->\n<script lang=\"ts\">\n  import type { Snippet } from 'svelte';\n  import type { NDKEvent } from '@nostr-dev-kit/ndk';\n  import type { NDKSvelte } from '@nostr-dev-kit/svelte';\n  import { createEventContent, type ParsedSegment } from '@nostr-dev-kit/svelte';\n  import type { KindRegistry } from './registry.svelte';\n  import { getDefaultMention } from './mention-registry.svelte';\n  import Mention from './mention/mention.svelte';\n  import Hashtag from './hashtag/hashtag.svelte';\n  import EmbeddedEvent from './event/event.svelte';\n\n  interface EventContentProps {\n    ndk: NDKSvelte;\n    event?: NDKEvent;\n    content?: string;\n    emojiTags?: string[][];\n    class?: string;\n    kindRegistry?: KindRegistry;\n    mention?: Snippet<[{ bech32: string }]>;\n    eventRef?: Snippet<[{ bech32: string }]>;\n    hashtag?: Snippet<[{ tag: string }]>;\n    link?: Snippet<[{ url: string }]>;\n    media?: Snippet<[{ url: string }]>;\n    emoji?: Snippet<[{ shortcode: string; url: string }]>;\n    imageGrid?: Snippet<[{ urls: string[] }]>;\n    showMedia?: boolean;\n    showLinkPreview?: boolean;\n    highlightMentions?: boolean;\n  }\n\n  let {\n    ndk,\n    event,\n    content: contentProp,\n    emojiTags,\n    class: className = '',\n    kindRegistry,\n    mention,\n    eventRef,\n    hashtag,\n    link,\n    media,\n    emoji,\n    imageGrid,\n    showMedia,\n    showLinkPreview,\n    highlightMentions,\n  }: EventContentProps = $props();\n\n  // Get default mention component (snippet takes precedence)\n  const DefaultMention = mention ? null : getDefaultMention();\n\n  const parsed = createEventContent(() => ({\n    event,\n    content: contentProp,\n    emojiTags\n  }), ndk);\n</script>\n\n<div class=\"event-content {className}\">\n  {#each parsed.segments as segment, i (i)}\n    {#if segment.type === 'text'}\n      {segment.content}\n    {:else if segment.type === 'npub' || segment.type === 'nprofile'}\n      {#if segment.data && typeof segment.data === 'string'}\n        {#if mention}\n          {@render mention({ bech32: segment.data })}\n        {:else if DefaultMention}\n          <DefaultMention {ndk} bech32={segment.data} />\n        {:else}\n          <Mention {ndk} bech32={segment.data} />\n        {/if}\n      {/if}\n    {:else if segment.type === 'event-ref'}\n      {#if segment.data && typeof segment.data === 'string'}\n        {#if eventRef}\n          {@render eventRef({ bech32: segment.data })}\n        {:else}\n          <EmbeddedEvent {ndk} bech32={segment.data} {kindRegistry} />\n        {/if}\n      {/if}\n    {:else if segment.type === 'hashtag'}\n      {#if segment.data && typeof segment.data === 'string'}\n        {#if hashtag}\n          {@render hashtag({ tag: segment.data })}\n        {:else}\n          <Hashtag tag={segment.data} />\n        {/if}\n      {/if}\n    {:else if segment.type === 'link'}\n      {#if link}\n        {@render link({ url: segment.content })}\n      {:else}\n        <!-- svelte-ignore a11y_invalid_attribute -->\n        <a href={segment.content} target=\"_blank\" rel=\"noopener noreferrer\" class=\"link\">\n          {segment.content}\n        </a>\n      {/if}\n    {:else if segment.type === 'media'}\n      {#if media}\n        {@render media({ url: segment.content })}\n      {:else}\n        {#if segment.content.match(/\\.(jpg|jpeg|png|gif|webp|svg)(\\?|$)/i)}\n          <img src={segment.content} alt=\"\" class=\"media-image\" />\n        {:else if segment.content.match(/\\.(mp4|webm|mov)(\\?|$)/i)}\n          <!-- svelte-ignore a11y_media_has_caption -->\n          <video src={segment.content} controls class=\"media-video\"></video>\n        {:else if segment.content.match(/youtube\\.com|youtu\\.be/i)}\n          {@const videoId = segment.content.match(/(?:youtube\\.com\\/watch\\?v=|youtu\\.be\\/|youtube\\.com\\/embed\\/)([a-zA-Z0-9_-]{11})/)?.[1]}\n          {#if videoId}\n            <iframe\n              src=\"https://www.youtube.com/embed/{videoId}\"\n              title=\"YouTube video\"\n              class=\"media-youtube\"\n              frameborder=\"0\"\n              allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\"\n              allowfullscreen\n            ></iframe>\n          {/if}\n        {/if}\n      {/if}\n    {:else if segment.type === 'emoji'}\n      {#if emoji && typeof segment.data === 'string'}\n        {@render emoji({ shortcode: segment.content, url: segment.data })}\n      {:else if typeof segment.data === 'string'}\n        <img src={segment.data} alt=\":{segment.content}:\" class=\"custom-emoji\" />\n      {/if}\n    {:else if segment.type === 'image-grid'}\n      {#if segment.data && Array.isArray(segment.data)}\n        {#if imageGrid}\n          {@render imageGrid({ urls: segment.data })}\n        {:else}\n          <div class=\"image-grid\">\n            {#each segment.data as url, j (j)}\n              <img src={url} alt=\"\" class=\"grid-image\" />\n            {/each}\n          </div>\n        {/if}\n      {/if}\n    {/if}\n  {/each}\n</div>\n\n<style>\n  .event-content {\n    white-space: pre-wrap;\n    word-break: break-word;\n    line-height: 1.6;\n  }\n\n  .mention,\n  .event-ref {\n    color: var(--color-primary);\n    text-decoration: none;\n    font-weight: 500;\n    cursor: pointer;\n  }\n\n  .mention:hover,\n  .event-ref:hover {\n    text-decoration: underline;\n  }\n\n  .hashtag {\n    color: var(--color-primary);\n    cursor: pointer;\n  }\n\n  .hashtag:hover {\n    text-decoration: underline;\n  }\n\n  .link {\n    color: var(--color-primary);\n    text-decoration: underline;\n    word-break: break-all;\n  }\n\n  .link:hover {\n    opacity: 0.8;\n  }\n\n  .media-image {\n    max-width: 100%;\n    height: auto;\n    border-radius: 0.5rem;\n    margin: 0.5rem 0;\n  }\n\n  .media-video {\n    max-width: 100%;\n    border-radius: 0.5rem;\n    margin: 0.5rem 0;\n  }\n\n  .media-youtube {\n    width: 100%;\n    aspect-ratio: 16 / 9;\n    border-radius: 0.5rem;\n    margin: 0.5rem 0;\n  }\n\n  .custom-emoji {\n    display: inline-block;\n    width: 1.25em;\n    height: 1.25em;\n    vertical-align: middle;\n    margin: 0 0.1em;\n  }\n\n  .image-grid {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n    gap: 0.5rem;\n    margin: 0.5rem 0;\n  }\n\n  .grid-image {\n    width: 100%;\n    height: auto;\n    object-fit: cover;\n    border-radius: 0.5rem;\n    aspect-ratio: 1;\n  }\n</style>\n","type":"registry:ui","target":"event/content/event-content.svelte"}],"version":"0.8.0","updatedAt":"2025-10-31T07:15:56.000Z"}