<script lang="ts">
  import type { NDKSvelte } from '@nostr-dev-kit/svelte';
  import type { EmojiData } from '$lib/registry/components/emoji-picker';
  import { createEmojiPicker } from '$lib/registry/components/emoji-picker';

  interface Props {
    ndk: NDKSvelte;
  }

  let { ndk }: Props = $props();

  let textarea = $state<HTMLTextAreaElement>();
  let text = $state('');
  let open = $state(false);
  let searchQuery = $state('');
  let selectedIndex = $state(0);

  const emojiState = createEmojiPicker(() => ({
    defaults: [{ emoji: "ðŸ‘" }],
    from: ndk.$follows
  }), ndk);

  const filteredEmojis = $derived.by((): EmojiData[] => {
    if (!searchQuery) return emojiState.emojis.slice(0, 10);
    return emojiState.emojis.filter(emoji =>
      emoji.shortcode?.toLowerCase().includes(searchQuery.toLowerCase())
    ).slice(0, 10);
  });

  function handleInput(e: Event) {
    const target = e.target as HTMLTextAreaElement;
    text = target.value;
    // ... autocomplete logic
  }
</script>

<textarea
  bind:this={textarea}
  bind:value={text}
  oninput={handleInput}
  class="w-full min-h-32 p-3 border rounded-lg bg-background"
  placeholder="Type : to search for emojis..."
></textarea>
