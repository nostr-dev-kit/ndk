<script lang="ts">
  import { createReplyAction } from '$lib/registry/builders/reply-action.svelte.js';

  const replyAction = createReplyAction(() => ({ event }), ndk);

  let showDialog = $state(false);
  let replyContent = $state('');
  let isSubmitting = $state(false);

  async function handleSubmit() {
    if (!replyContent.trim() || isSubmitting) return;

    isSubmitting = true;
    try {
      await replyAction.reply(replyContent);
      replyContent = '';
      showDialog = false;
    } catch (error) {
      console.error('Failed to publish reply:', error);
    } finally {
      isSubmitting = false;
    }
  }
</script>

<button onclick={() => showDialog = true}>
  <span>{replyAction.count}</span>
</button>

{#if showDialog}
  <div>
    <textarea bind:value={replyContent} placeholder="Write your reply..."></textarea>
    <button onclick={() => showDialog = false}>Cancel</button>
    <button onclick={handleSubmit} disabled={!replyContent.trim() || isSubmitting}>
      {isSubmitting ? 'Sending...' : 'Reply'}
    </button>
  </div>
{/if}
