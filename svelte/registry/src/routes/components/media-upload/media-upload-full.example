<script lang="ts">
  import { MediaUpload } from '$lib/registry/ui/media-upload';
  import type { MediaUploadResult } from '$lib/registry/ui/media-upload';

  let uploads = $state<MediaUploadResult[]>([]);

  function removeUpload(index: number) {
    uploads = uploads.filter((_, i) => i !== index);
  }

  function reorderUpload(fromIndex: number, toIndex: number) {
    const newUploads = [...uploads];
    const [removed] = newUploads.splice(fromIndex, 1);
    newUploads.splice(toIndex, 0, removed);
    uploads = newUploads;
  }
</script>

<MediaUpload.Root {ndk} bind:uploads accept="image/*,video/*" maxFiles={10}>
  <MediaUpload.Carousel>
    {#each uploads as upload, index}
      <MediaUpload.Item
        {upload}
        {index}
        onRemove={removeUpload}
        onReorder={reorderUpload}
      />
    {/each}
    <MediaUpload.Button />
  </MediaUpload.Carousel>
</MediaUpload.Root>
